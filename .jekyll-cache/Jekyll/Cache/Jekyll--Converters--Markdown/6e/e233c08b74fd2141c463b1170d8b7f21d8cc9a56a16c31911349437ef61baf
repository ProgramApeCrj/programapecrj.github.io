I"(<p>å‰è¨€ï¼šä¸€èˆ¬æˆ‘ä»¬å¼€å‘ç¯å¢ƒéœ€è¦å¤šä¸ªè½¯ä»¶é…åˆï¼Œå¹³æ—¶æ˜¯åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œæ‰€ä»¥ä¸åŒè½¯ä»¶è¿›ç¨‹ä¸­å¯ä»¥äº’ç›¸é€šä¿¡ã€‚ä½†æ˜¯ç°åœ¨æ˜¯åœ¨ä¸åŒçš„å®¹å™¨ä¸­ï¼Œä¸åŒçš„å®¹å™¨é—´çš„è¿›ç¨‹æ˜¯æ€ä¹ˆäº’ç›¸è®¿é—®çš„å‘¢ï¼Ÿ</p>

<p><br /></p>
<h1 id="å¯¼èˆª">å¯¼èˆª</h1>
<ol>
  <li>å‰çŸ¥æ¡ä»¶</li>
  <li>å®‰è£…nginx</li>
  <li>å®‰è£…mysql</li>
  <li>å®‰è£…php-fpm</li>
  <li>å®¹å™¨é—´äº’ç›¸é€šä¿¡</li>
  <li>å°demoæµ‹è¯•</li>
  <li>docker-composer</li>
  <li>å…¶ä»–</li>
  <li>æ€»ç»“</li>
</ol>

<p><br /></p>
<h1 id="1-å‰çŸ¥æ¡ä»¶">1. å‰çŸ¥æ¡ä»¶</h1>

<p>é¦–å…ˆè¦çŸ¥é“ï¼Œdocker çš„ å®¹å™¨é€šè®¯ æä¾›äº†ä¸€ç§åˆ«åé€šè®¯çš„åšæ³•ï¼Œç¡®ä¿å®¹å™¨é—´çš„é€šè®¯ä¾èµ–çš„æ˜¯ä¸€ä¸ªå›ºå®šçš„åç§°ï¼Œè€Œä¸æ˜¯å¯èƒ½ä¼šå˜çš„ ip åœ°å€ã€‚</p>

<p>ç„¶åè¦äº†è§£ä¸€ä¸‹ä¸¤ä¸ªå‘½ä»¤ï¼š</p>

<ul>
  <li>â€“link</li>
</ul>

<p>è¿™æ˜¯ä¸€ç§è¿‡æ—¶çš„åšæ³•ï¼Œlink å…·æœ‰æ–¹å‘æ€§ï¼Œå¦‚æœéœ€è¦äº’ç›¸è®¿é—®å°±GGã€‚</p>

<ul>
  <li>â€“network</li>
</ul>

<p>å®˜æ–¹æ¨èåšæ³•ï¼Œå®¹å™¨é—´å…±åŒä¾èµ–ä¸€ä¸ªç½‘ç»œï¼Œä»è€Œå®ç°äº’ç›¸è®¿é—®ï¼Œä¸‹é¢ä¹Ÿæ˜¯ä½¿ç”¨è¿™ç§åŠæ³•ã€‚</p>

<p><br /></p>
<h1 id="2-å®‰è£…-nginx">2. å®‰è£… nginx</h1>
<h3 id="æ‹‰å–é•œåƒ">æ‹‰å–é•œåƒï¼š</h3>

<blockquote>
  <p>docker pull hub.c.163.com/library/nginx:latest</p>
</blockquote>

<h3 id="å¯åŠ¨å®¹å™¨">å¯åŠ¨å®¹å™¨ï¼š</h3>

<blockquote>
  <p>docker run -p 80:80 â€“name mynginx -d hub.c.163.com/library/nginx</p>
</blockquote>

<h3 id="å¤åˆ¶ç›®å½•">å¤åˆ¶ç›®å½•ï¼š</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker container cp å®¹å™¨å: /usr/share/nginx/html .
docker container cp å®¹å™¨å: /etc/nginx .
mv nginx conf
docker container cp å®¹å™¨å: /var/log/nginx/ .
mv nginx log
</code></pre></div></div>

<p><br /></p>
<h1 id="3-å®‰è£…-mysql">3. å®‰è£… mysql</h1>

<h3 id="æ‹‰å–é•œåƒ-1">æ‹‰å–é•œåƒï¼š</h3>
<blockquote>
  <p>docker pull hub.c.163.com/library/mysql:latest</p>
</blockquote>

<h3 id="å¯åŠ¨å®¹å™¨-1">å¯åŠ¨å®¹å™¨ï¼š</h3>
<blockquote>
  <p>docker run -d -p 3306:3306  â€“name mysql  -e MYSQL_ROOT_PASSWORD=123456 hub.c.163.com/library/mysql:latest</p>
</blockquote>

<h3 id="å¤åˆ¶ç›®å½•-1">å¤åˆ¶ç›®å½•ï¼š</h3>

<p>è¿›åˆ°å®¹å™¨å†…ï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤æŸ¥çœ‹é…ç½®æ–‡ä»¶çš„ä½ç½®</p>

<blockquote>
  <p>mysql â€“verbose â€“help | grep -A 1 â€˜Default optionsâ€™</p>
</blockquote>

<p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®˜æ–¹æ–‡æ¡£å»æŸ¥çœ‹ï¼š</p>

<ul>
  <li>.cnf æ–‡ä»¶ä½ç½®</li>
</ul>

<p><img src="https://127.0.0.1:4000/img/18-11-06@01.png" alt="image" /></p>

<ul>
  <li>data æ–‡ä»¶ä½ç½®</li>
</ul>

<p><img src="https://127.0.0.1:4000/img/18-11-06@02.png" alt="image" /></p>

<ul>
  <li>é”™è¯¯æ—¥å¿— log çš„ä½ç½®éœ€è¦è‡ªå·±æ‰¾ä¸€ä¸‹</li>
</ul>

<p><img src="https://127.0.0.1:4000/img/18-11-06@03.png" alt="image" /></p>

<p>æœ€ç»ˆçš„å¤åˆ¶å‘½ä»¤å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker container cp mysql:/etc/mysql/conf.d .
docker container cp mysql:/var/lib/mysql .
mv mysql data
docker container cp mysql:/var/log/mysql .
mv mysql log
</code></pre></div></div>

<p><br /></p>
<h1 id="4-å®‰è£…-php-fpm">4. å®‰è£… php-fpm</h1>

<h3 id="æ‹‰å–é•œåƒ-2">æ‹‰å–é•œåƒï¼š</h3>
<blockquote>
  <p>docker pull hub.c.163.com/library/php:7.1.9-fpm</p>
</blockquote>

<h3 id="å¯åŠ¨å®¹å™¨-2">å¯åŠ¨å®¹å™¨ï¼š</h3>
<blockquote>
  <p>docker run -p 9000 :9000  â€“name myphp-fpm   -d  hub.c.163.com/library/php:7.1.9-fpm</p>
</blockquote>

<h3 id="å¤åˆ¶ç›®å½•-2">å¤åˆ¶ç›®å½•ï¼š</h3>

<p>ä¸»è¦å°±æ˜¯ www ç›®å½•ã€php.ini ä»¥åŠ php-fpm.conf ï¼ˆä»¥åå¯èƒ½è¿˜éœ€è¦å®šæ—¶ä»»åŠ¡ crontab å’Œ php-fpm.logï¼‰</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker container cp myphp-fpm:/var/www   .
docker container cp myphp-fpm:/usr/local/etc/php   .
docker container cp myphp-fpm:/usr/local/etc/php-fpm.conf .
docker container cp myphp-fpm:/usr/local/etc/php-fpm.d .

</code></pre></div></div>

<h3 id="docker-ä¸‹çš„-php-fmp-å®‰è£…æ‹“å±•">docker ä¸‹çš„ php-fmp å®‰è£…æ‹“å±•</h3>

<p>å¯ä»¥ç›´æ¥åœ¨è¿è¡Œçš„å®¹å™¨ä¸­ä½¿ç”¨</p>

<blockquote>
  <p>docker-php-ext-install æ‹“å±•å</p>
</blockquote>

<p>ä½†æ˜¯è‚¯å®šä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå®¹å™¨ä¸€æ—¦åˆ é™¤ï¼Œæ‹“å±•å°±æœ¨å¾—å•¦ï¼Œæ€ä¹ˆåŠï¼Ÿæ‹“å±•åˆä¸èƒ½æŒä¹…åŒ–ï¼Ÿå…¶å®åªè¦å†™ä¸€ä¸ª dockerfileï¼Œæ„å»ºä¸€ä¸ªå¸¦æ‹“å±•çš„é•œåƒï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM php:7.1-fpm
RUN apt-get update \
	# ç›¸å…³ä¾èµ–å¿…é¡»æ‰‹åŠ¨å®‰è£…
	&amp;&amp; apt-get install -y \
        libfreetype6-dev \
        libjpeg62-turbo-dev \
        libmcrypt-dev \
        libpng-dev \
    # å®‰è£…æ‰©å±•
    &amp;&amp; docker-php-ext-install -j$(nproc) iconv mcrypt \
    # å¦‚æœå®‰è£…çš„æ‰©å±•éœ€è¦è‡ªå®šä¹‰é…ç½®æ—¶
    &amp;&amp; docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \
    &amp;&amp; docker-php-ext-install -j$(nproc) gd

</code></pre></div></div>
<p>åƒ PECL æ‰©å±•æˆ–è€…å…¶ä»–æ‹“å±•ä¹ŸåŒç†</p>

<p><br /></p>
<h1 id="5-å®¹å™¨é—´äº’ç›¸é€šä¿¡">5. å®¹å™¨é—´äº’ç›¸é€šä¿¡</h1>

<p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªç½‘ç»œ</p>

<blockquote>
  <p>docker network create nginx-network</p>
</blockquote>

<p>è¿›å…¥åˆ°å®¿ä¸»æœº nginx çš„æ–‡ä»¶ï¼Œå¯åŠ¨ nginx å®¹å™¨ï¼Œä½¿ç”¨ â€“net å‘½ä»¤</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run \
-p:80:80 \
--name mynginx \
--net nginx-network \
-v "$PWD/html":/usr/share/nginx/html \
-v "$PWD/conf":/etc/nginx \
-v "$PWD/log":/var/log/nginx/ \
-v "/home/data/php/www":/usr/share/nginx/www \
-d hub.c.163.com/library/nginx  
</code></pre></div></div>

<p>åŒç† ï¼Œè¿›å…¥åˆ° php æ–‡ä»¶å¤¹ä¸­å¯åŠ¨ php ï¼Œè¿æ¥åˆ°è¿™ä¸ªç½‘ç»œä¸­å»</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -p 9000:9000 \
--name myphp-fpm \
--net nginx-network \
-v "$PWD/php-fpm.conf":/usr/local/etc/php-fpm.conf \
-v "$PWD/php-fpm.d":/usr/local/etc/php-fpm.d \
-v "$PWD/php":/usr/local/etc/php \
-v "$PWD/www":/var/www \
-d  hub.c.163.com/library/php:7.1.9-fpm
</code></pre></div></div>

<p>ç„¶åæ˜¯ mysql</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -d \
-p 3306:3306 \
--net nginx-network \
--name my-mysql \
-v "$PWD/conf.d ":/etc/mysql/conf.d \
-v "$PWD/data":/var/lib/mysql  \
-v "$PWD/log":/var/log/mysql \
-e MYSQL_ROOT_PASSWORD=123456 \
hub.c.163.com/library/mysql:latest \
</code></pre></div></div>

<p><br /></p>
<h1 id="6-å°-demo-æµ‹è¯•">6. å° demo æµ‹è¯•</h1>

<p>åŸºäºä¸Šé¢çš„ä¸€äº›é…ç½®ï¼Œæˆ‘ä»¬æ¥å†™ä¸€äº›å° demo çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰ç”Ÿæ•ˆ</p>

<h3 id="php-ä¸-nginx">php ä¸ nginx</h3>

<p>æ‰“å¼€ Nginxä¸‹çš„ conf/conf.d/default.confï¼Œå¢åŠ å¦‚ä¸‹é…ç½®</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> location ~ \.php$ {
       # myphp-fpm æ˜¯å®¹å™¨åç§°
       fastcgi_pass   myphp-fpm:9000;  
       fastcgi_index  index.php;
       # /var/www æ˜¯ myphp-fpm å®¹å™¨ä¸­æ”¾ php æ–‡ä»¶çš„ä½ç½®
       fastcgi_param  SCRIPT_FILENAME  /var/www/$fastcgi_script_name; 
       include        fastcgi_params;
    }

</code></pre></div></div>

<p>æ‰“å¼€ phpä¸‹çš„ www ç›®å½•ï¼Œæ–°å»ºä¸€ä¸ª index.php ,åŠ å…¥</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">echo</span> <span class="nb">phpinfo</span><span class="p">();</span>
</code></pre></div></div>

<p>è®¿é—® ip/index.php å³å¯çœ‹åˆ°å¦‚ä¸‹ç”»é¢</p>

<p><img src="https://127.0.0.1:4000/img/18-11-06@04.png" alt="image" /></p>

<p>è¯´æ˜ php å®¹å™¨å·²ç»å’Œ nginx è¿é€šäº†ã€‚</p>

<h3 id="php-ä¸-mysql">php ä¸ mysql</h3>

<p>é¦–å…ˆè¿›åˆ°å®¹å™¨å†…ï¼Œå®‰è£…ä¸€ä¸‹æ‹“å±•</p>

<blockquote>
  <p>docker-php-ext-install  pdo_mysql</p>
</blockquote>

<p>php è¿æ¥ æ•°æ®åº“ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">echo</span> <span class="s1">'123'</span><span class="p">;</span>
<span class="nv">$servername</span> <span class="o">=</span> <span class="s2">"my-mysql;dbname=mysql"</span><span class="p">;</span>
<span class="nv">$username</span> <span class="o">=</span> <span class="s2">"root"</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">"123456"</span><span class="p">;</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$conn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s2">"mysql:host=</span><span class="nv">$servername</span><span class="s2">;"</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">);</span>
    <span class="k">echo</span> <span class="s2">"è¿æ¥æˆåŠŸ"</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>å‡ºç°å¦‚ä¸‹ç”»é¢è¯´æ˜ php å’Œ mysql å®¹å™¨ä¹Ÿæ˜¯æ­£å¸¸é€šä¿¡äº†</p>

<p><img src="https://127.0.0.1:4000/img/18-11-06@05.png" alt="image" /></p>

<p><br /></p>
<h1 id="7-docker-composer">7. docker-composer</h1>

<p>çœ‹åˆ° composer è¿™ä¸ªå­— æˆ‘ä»¬å°±çŸ¥é“è¿™æ˜¯ä¸€ä¸ªä¾èµ–ç®¡ç†ï¼Œè‡ªåŠ¨åŒ–å·¥å…·äº†ã€‚
å®ƒèƒ½å®šä¹‰å®¹å™¨çš„å¯åŠ¨é¡ºåºï¼Œç›®å½•æ˜ å°„è§„åˆ™ï¼Œç½‘ç»œè¿æ¥ç­‰ç­‰ï¼Œå½¢æˆç»Ÿä¸€çš„ç®¡ç†ã€‚</p>

<p><br /></p>
<h1 id="8-å…¶ä»–">8. å…¶ä»–</h1>
<p>å¦‚æœæƒ³æ›´æ–¹ä¾¿ï¼Œè¿˜å¯ä»¥æŠŠå®¹å™¨çš„å¯åŠ¨è®¾ç½®ä¸ºå¼€å¯è‡ªå¯ã€‚è¿™äº›å…¶ä»–çŸ¥è¯†å†æ…¢æ…¢è¡¥å……å§ã€‚</p>

<p><br /></p>
<h1 id="9æ€»ç»“">9.æ€»ç»“</h1>

<p>æ€»çš„æ¥è¯´å°±æ˜¯</p>

<ul>
  <li>æ„å»ºå‡ºä¸åŒçš„å®¹å™¨</li>
  <li>å¤åˆ¶å‡ºå®¹å™¨éœ€è¦æŒä¹…åŒ–çš„æ•°æ®ï¼Œå¹¶åšç›®å½•æ˜ å°„</li>
  <li>è¿æ¥å„è‡ªçš„ç½‘ç»œ</li>
  <li>æµ‹è¯•</li>
</ul>

<p><br /></p>
<h5 id="åè¯">åè¯ï¼š</h5>
<p>åé¢å†è®²ä¸€ä¸‹å¦‚ä½•ç”¨ vmbox è™šæ‹Ÿæœº + centOS+ NMP + Docker ï¼Œæ„å»ºå‡ºä¸€å¥—éšæ—¶å¯ä»¥ç§»åŠ¨çš„å¼€å‘ç¯å¢ƒã€‚</p>

:ET