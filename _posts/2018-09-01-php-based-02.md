---
layout: default_post
title : 通过对比Java学PHP基础【中：应用层面】（分类：PHP基础）
---


前言：上一篇博文[《通过对比Java学PHP基础【上：语法层面】》](https://programapecrj.github.io/2018/06/24/php-based-01.html)，我简单地对比了一下两者一些语法的异同，今天讲讲一些常见的，应用层面上的不同。

<br>
## 导航
1. 命名空间与类加载
1. 单元测试
1. 代码调试，追踪
1. 魔术办法
1. 变量类型
1. 异常处理
1. 构造函数
1. 引用传递
1. 单双引号
1. static
1. 其他
1. 总结



<br>
# 1.命名空间与类加载
一般语言为为了更好地组织类，都有命名空间这一说。Java 叫 package（包），PHP 叫 namespace（命名空间）。

Java 的包规则是规定好的，与文件夹同名，一般这样写。

```
package net.java.util;
public class Something{
   ...
}
```
那么它的实际路径应该是 net/java/util/Something.java 这样保存的。

Java 的类加载，就是加载 .class 文件，不同类型的 .class 文件会有不同的 class loader 负责。

一般情况下我们不需要自己去写加载过程，比如在 ecllipe 下，最多就是 build path 一下，编程工具就可以找到这个路径对应的 jar 包的文件。

而 Java Web 项目，只需要把 Jar 包放入 webroot 下的 lib 文件夹，因为容器实现了自己的 ClassLoader。（ Web 中间件服务器类加载的机制和 sun 公司提供的3个默认加载器不同。）

有时候导入别人的项目，会出现找不到类库，往往就是要路径不一致导致的。

PHP 的 namespace，可以用于区分不同个脚本文件（或同个脚本不同位置）中，相同名称的属性，办法，类名。


```
<?php
namespace MyProject {
    const CONNECT_OK = 1;
    class Connection { /* ... */ }
    function connect() { /* ... */  }
}

namespace AnotherProject {
    const CONNECT_OK = 1;
    class Connection { /* ... */ }
    function connect() { /* ... */  }
}
?>
```

对于类加载，PHP靠着 include 和 require 也可以实现其他 PHP 文件的引入，但是依赖一多就难以管理。

所以很多框架利用 spl_autoload_register() 配合 namespace，遵守 PSR-4 规范，去实现类自动加载。

<br>
# 2.单元测试
写完一个办法，我们一般会简单测一下办法是否符合预期输出。

Java 每个文件都有入口函数，可以用 Main 函数去调用该办法，然后编译运行输出。项目比较大的时候就使用 junit 。

PHP，没有所谓的入口函数。不过可以直接在 PHP 文件的空白直接调用该办法，Cli 模式下运行。项目比较大的时候就使用 PHPunit 。

<br>
# 3.代码调试，追踪
写程序肯定会有 Bug ，调试是必须要会的，代码追踪也是。

Java 的调试和代码追踪明显比较友好，一般 IDE 都支持了。

身为脚本语言的 PHP ，调试的话，一般就是 exit, print 一顿搓，还好办。

但是代码追踪就难受了。在不同的 PHP 框架中，类加载机制可能不一样，加上魔术办法满天飞，成员属性也可以不预先定义，常常出现 IDE 无法识别某个类，办法或者属性的情况，只能通过某些手段去实现追踪（比如 phpstorm 需要安装 laravel-ide-helper 才能识别部分 Laravel 的办法）。


<br>
# 5.依赖管理工具
依赖一直是件很头疼的事情，故很多语言都会有专门的依赖管理工具。

Maven 之于 Java 就像 Composer 之于 PHP。

不过 PHP 还有个东东叫拓展，原生的 C 写的，和依赖还是有些区别的。

<br>
# 6.魔术办法
动态语言都有很多静态语言没有的动态特征，魔术办法就是其中一个。魔术办法能带来很多方便，比如利用 __call() 函数的特性，可以实现简单的 AOP 。而 Java 可能需要代理模式等设计模式去实现。

<br>
# 7.变量类型
Java 由于是强类型，静态语言，所以在编译前需要指定类型。如果想在运行时才能确定类型，一般需要泛型来编程。

PHP 就是动态语言，显然不需要这样做（虽然也可以指定类型）。

这样带来了一些恐怖的不确定性，举个简单例子：


```
0 == '0' == false == null == ' ' 
```

这意味着，你无法完全信任返回的值，有时必须先去判断其类型，代码写起来战战兢兢。

不然返回一个 null ，当做 0 处理，肯定会很大的隐患。

也正是由于办法的返回值类型的不确定性，一般团队的代码会规范不准用 0 作为状态码。一个办法只能返回一种类型，返回类型一定写在注释上等等。。。


<br>
# 8.异常处理
异常和错误，在不同语言的说法可能是不一样的。

PHP 中，PHP 一旦遇到非正常代码，通常会触发错误，而不是异常。比如错误的语法，服务器环境导致，并且错误是不能被 Try-Catch 捕获的。

这就导致了一个问题，PHP 不要求你必须 Try-Catch。这让写惯了“ 十行代码，八行异常处理 ”的 Java 的我有点接受不了。

如果想捕获错误，必须使用 set_error_handlert 去做文章，将错误转为异常，抛出，才能捕获到。

Java 将异常分为错误，受检异常，运行时（非受检）异常。

错误，用来指示运行时环境发生的错误。例如，JVM 内存溢出。一般地，程序不会从错误中恢复，错误不可捕获。

而受检查型异常，指的是一个函数的代码逻辑没有错误，但程序运行时会因为 IO，SQL 操作等错误导致异常，你在编写程序阶段是无法判断的，所以要提前写好检查。一般编译器会提示你要去捕获并处理这种可能发生的异常，不处理就不能通过编译。

运行时异常，又称未检查异常，指的是你的程序逻辑本身不严谨，比如数组越界、访问 null 对象，这种错误你自己是可以避免的，比如提前判断是否为 null，修改代码保证下标不会越界。这类型的话，编译器不会强制你检查这种异常。也检查不过来，太多了。

另外，业务异常一般都继承自运行时异常，在 Spring 的事务管理中，抛出运行时异常，才可以让事务回滚。

纠结很久的一个问题，在 SQL 操作中，可能会抛出的异常（或者出现的错误）会有哪些？如果是捕获不到的异常或者错误，怎么确保事务能正确得到回滚？

<br>
# 9.构造函数
PHP 居然只有单构造函数，不像 Java，构造函数和普通办法一样，可以重载。

<br>
# 10.引用传递

Java 中对象是引用传递，数组是引用传递，普通变量是值传递。

而 PHP 可以使一个普通变量变成引用传递，不过好像不推荐。

<br>
# 11.单双引号
Java 中，单引号是 Char 类型，双引号是字符串类型。

PHP 中，单双引号都可以是字符串类型，双引号里面的变量会经过编译器解释，单引号里面的不进行解释，直接输出。两者配合还有很多奇效：


```
$abc='my name is tome';
echo '$abc' ;//结果是:$abc
echo "'hi',$abc" ;//结果是:'hi',my name is tome
```

<br>
# 12.static
这里有一个坑，千万不能先入为主。把 PHP 的 static 当做 Java 的 static。

Java 是常驻内存，故类一加载，static 标注的变量，在整个程序（或者服务器）的运行期间，都是一直存在的，这个变量是共享的。

而 PHP 就在脚本执行完后，就销毁了，根本不存在共享这一说，或者说只在同一次请求中共享。（不过 PHP 也有常驻内存的模式）。

这样的话其实也好，不同的请求之间不会有数据污染问题，而且想要共享的话，Redis　缓存搞一下。

<br>
# 13.其他

其他像闭包和回调，数据库操作，i/o呀， 网络编程和多线程那一块，后面比较深入学习，再慢慢总结。。

<br>
# 14.总结
通过上面一些比较，学一门新语言，其实就是用一门学过的语言，去对比新语言的概念、语法与应用、特色、底层等几方面的异同。我的大致理解如下：

### 概念：
首先，怎么都要先大概了解
- 区分是动态脚本 or 静态编译型
- 区分是强类型 or 弱类型
- 区分是为了什么场景而生的，在什么场景占优，在什么场景占劣

等一系列概念上，理论上的问题。不需要全懂，但是提前理解会有好处。

### 语法，基本应用：
用一门语言学到过的知识（语法，基本应用），去看另一门语言在这些场景下是怎么做的。

然后就是学习该语言可以缩减代码量的小技巧，提高可读性的语法糖。不停地踩过去一个一个的坑。

### 特色：
接着呢，要特别注意有一些看似相同，其实是有差异的，而且是很大的差异的那种知识。

再者，有一些是语言特有的知识，这就是特色，要记下。
这些特色很多时候是因为语言本身的设计导致的。


### 底层
然后学到最后，境界高一点，还可以学一学语言底层的东西。


### 个人认为

个人认为，一点比较好的实践就是：

新语言，新知识肯定是学不完的，但是，当前工作中反复用到的，必须掌握的，一定要会。

不理解清楚会导致程序编写错误的，一定要去理解清楚。  

至于那些语法糖，或者更优雅编程的办法，高级的应用手法，熟手了，自然会用。

偏向底层那些，能力到了，自然会看，无需纠结。


以上

<br>
##### 结语：胡言乱语一通。。。








